<!DOCTYPE html>
<html>
  <head>
    <title>For the Moon is Hollow and I Have Touched the Sky</title>
    <meta http-equiv="Pragma" content="no-cache, no-store" />
    <meta http-equiv="Expires" content="31 Dec 1997" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bacon.js/3.0.13/Bacon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ramda/0.25.0/ramda.min.js"></script>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <script type="text/javascript">

      var cjs = createjs;
      
      //--------------------------------------------------------------------------- init
      function init(){


	  var keys = {arrowup:0, arrowdown:0, arrowleft:0, arrowright:0};

	  document.onkeydown = (e) => {
	      if(e.repeat){return;};
	      let k = e.key.toLowerCase();
	      if(keys.hasOwnProperty(k)){ keys[k] = 1; };
	  };
	  document.onkeyup = (e) => {
	      if(e.repeat){return;};
	      let k = e.key.toLowerCase();
	      if(keys.hasOwnProperty(k)){ keys[k] = 0; };
	  };
	  
	  
          cjs.Ticker.framerate = 60;
          cjs.Ticker.timingMode = cjs.Ticker.RAF;
          
          let stage = new cjs.Stage("canvas1");
          cjs.Ticker.addEventListener('tick', stage);

          stage.x = stage.y = 0.5;

	  let greyLayer = new cjs.Container();

	  let greyRect = new cjs.Shape();
	  greyRect.graphics
	      .s("#ccc")
	      .f("#ccc")
	      .dr(0,0,400,200)
	  
	  let blackLayer = new cjs.Container();
	      	  
	  let blackRect = new cjs.Shape();
	  blackRect.graphics
	      .s("#000000")
	      .f("#000000")
	      .dr(0,0,400,200)

	  let mask = new cjs.Shape();
	  mask.graphics
	      .f("#000000")
              .dc(0,0,60)

	  let trackdot = new cjs.Shape();
	  trackdot.graphics
	      .f("#000000")
              .dc(-3,-3,6)
	  trackdot.x = 60
	  trackdot.y = 30

	  greyLayer.addChild(greyRect);
	  greyLayer.addChild(trackdot)
	  
	  blackLayer.regX = 200;
	  blackLayer.regY = 100;
	  blackLayer.x = 200;
	  blackLayer.y = 100;	  
	  
	  
	  blackLayer.addChild(blackRect);
	  blackLayer.mask = mask;
	  

	  let masterContainer = new cjs.Container();
	  masterContainer.addChild(greyLayer);
	  masterContainer.addChild(blackLayer);	  
	  
	  stage.addChild(masterContainer);


	  let sighting = new cjs.Shape();
	  sighting.graphics
	      .s("#ff0000")
	      .dc(600,300,80)
	  stage.addChild(sighting);	  
	  
	  cjs.Tween.get(mask).wait(500).to({scaleX:6, scaleY:6}, (20 * 1000))
	  cjs.Tween.get(greyLayer).wait(500).to({scaleX:6, scaleY:6}, (20 * 1000))
	  cjs.Tween.get(blackLayer).wait(500).to({scaleX:6, scaleY:6}, (20 * 1000))	  	  

          cjs.Ticker.addEventListener('tick', function(){


	      greyLayer.x = 600 - ((greyLayer.scale * 400)/2)
	      greyLayer.y = 300 - ((greyLayer.scale * 200)/2)
	      blackLayer.x = 600 - ((blackLayer.scale * 400)/2)
	      blackLayer.y = 300 - ((blackLayer.scale * 200)/2)	      
	      
	      
	      if(keys.arrowdown) { masterContainer.y+=2 };
	      if(keys.arrowup)   { masterContainer.y-=2 };
	      if(keys.arrowleft) { masterContainer.x+=2 };
	      if(keys.arrowright){ masterContainer.x-=2 };

	      let pt = greyLayer.localToLocal(trackdot.x, trackdot.y, masterContainer);
	      mask.x = pt.x;
	      mask.y = pt.y;
	  });	  
	  
      }
	  
	  
	  //             stage.addChild(dotLayer);
	  //                 let s = new cjs.Shape();
	  //                 s.graphics
	  //                  .ss(4, "round")
	  //                  .beginStroke("#222")                 
	  //                  .moveTo(pt1.pixelX, pt1.pixelY)
	  //                  .lineTo(pt2.pixelX, pt2.pixelY)
	  //                  .es()
	  //                 patternLineLayer.removeAllChildren();
	  //             let newRoundBus = new Bacon.Bus();


	  //             function distance(pt1, pt2) {  
	  //                 return Math.sqrt(Math.pow((pt1.x - pt2.x), 2) + Math.pow((pt1.y - pt2.y), 2));
	  //             };


	  //                 cjs.Tween.get({}).wait(500).call(() => { startNewRound(); })
	  //                 cjs.Tween.get(lineLayer).to({alpha:0}, 200)
          
          window.onload = init;
          
    </script>

    <style>
      body {
          font-family: arial;
          font-size:16px;
          color:#222;
          text-align:center;
      }
      canvas { border:1px solid #000; display:block; margin:0px auto;}
    </style>

  </head>
  <body>

    <!-- 650 / 350 -->
    <canvas id="canvas1" width="1200" height="800"></canvas>

  </body>
</html>
